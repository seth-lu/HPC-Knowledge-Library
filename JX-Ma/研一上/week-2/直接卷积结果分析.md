## 环境

$N_i$ 批次大小维度

$C_i$ :输入张量通道维度

$C_0$ : 输出张量通道维度

$H_{i/f/o}$:输入张量/卷积核/输出张量高

$W_{i/f/o}$:输出张量/卷积核/输出张量宽



假设输入张量矩阵维度1 * 3 *  3 * 3 对应 批次维度(图片的个数)、通道维度(RGB)，高度，宽度

卷积核： 1 * 3 * 2 * 2 

输出张量 1 * 1 * 2 * 2

已知条件

 输出张量：   $N_o = 1 \qquad C_o = 1 \qquad H_o = 2 \qquad W_o = 2 $

卷积核： $C_f = 3 \qquad H_f = 2 \qquad W_f = 2$ 

步长s = 1







输入张量I
$$
\begin{matrix} 
1&2&3 \\
4&5&6  &&&&&		\text {red} \\
7&8&9	\\	 \\
11&12&13 \\
14&15&16  &&&&&	 \text {yellow} \\
17&18&19 \\ \\
21&22&23 \\
24&25&26  &&&&&	 \text {blue} \\
27&28&29 

\end{matrix}
$$


卷积核F
$$
\begin{matrix} 
31&32 \\
33&34  &&&&&		\text {red} \\
	\\	 \\
41&42 \\
43&44  &&&&&	 \text {yellow} \\
 \\ \\
51&52 \\
53&54  &&&&&	 \text {blue} \\ 
\end{matrix}
$$
输出张量O
$$
\begin{matrix} 
0&0 \\
0&0 
\end{matrix}
$$


## 作业一 说明卷积过程



![](C:\Users\14645\AppData\Roaming\Typora\typora-user-images\image-20230925165337727.png)

前四个for循环，遍历输出张量的每个值

后三个for循环，第一个分别遍历输入张量和卷积核张量的通道维度

剩下的两个做矩阵叉乘，令输入张量和卷积核张量的的第i行j列的元素记为$I_{ij}$和$F_{ji}$

则输入张量窗口中的第i行中的每个元素乘卷积核张量第i列中的每一个元素 --> $O_{ij}$+= $I_{ij}$*$F_{ji}$

 在变换输入张量和卷积核张量的通道维度继续做叉乘 最后结果相加得出输出张量







**为什么只有7层for循环的原因**

1. 三个张量共用一个批次维度 for-2
2. 输入张量的通道维度和卷积核的通道维度共用 for-1
3. 输入张量的窗口的行和列，对应卷积核张量的列和行，for-2

输入张量的宽和高与卷积核张量的宽和高不一样，但是窗口的大小一样，并且通过变化输出张量的宽和高来实现输入张量窗口的移动

**下面是运行函数的输出结果**

输出张量第1个元素运算开始 （即O[0,0,0,0]
第1步的乘数:1和31
第2步的乘数:2和32
第3步的乘数:4和33
第4步的乘数:5和34

**第一次叉乘完毕，变换维度**

第5步的乘数:11和41
第6步的乘数:12和42
第7步的乘数:14和43
第8步的乘数:15和44

**第二维度叉乘完毕，变换维度**

第9步的乘数:21和51
第10步的乘数:22和52
第11步的乘数:24和53
第12步的乘数:25和54

**第三次叉乘完毕，下面三层for循环完毕，变换输出张量的宽， 此时输入张量的窗口也随之变换， 输入张量窗口向右移动，宽+1**

输出张量第2个元素运算开始 （即O[0,0,0,1])
第1步的乘数:2和31
第2步的乘数:3和32
第3步的乘数:5和33
第4步的乘数:6和34



第5步的乘数:12和41
第6步的乘数:13和42
第7步的乘数:15和43
第8步的乘数:16和44

第9步的乘数:22和51
第10步的乘数:23和52
第11步的乘数:25和53
第12步的乘数:26和54

**输出张量第一行遍历完毕，遍历输出张量第二行的第一个元素，输入张量的窗口也随之变化**

输出张量第3个元素运算开始（即O[0,0,1,0])
第1步的乘数:4和31
第2步的乘数:5和32
第3步的乘数:7和33
第4步的乘数:8和34

第5步的乘数:14和41
第6步的乘数:15和42
第7步的乘数:17和43
第8步的乘数:18和44

第9步的乘数:24和51
第10步的乘数:25和52
第11步的乘数:27和53
第12步的乘数:28和54

输出张量第4个元素运算开始（即O[0,0,1,1])
第1步的乘数:5和31
第2步的乘数:6和32
第3步的乘数:8和33
第4步的乘数:9和34
第5步的乘数:15和41
第6步的乘数:16和42
第7步的乘数:18和43
第8步的乘数:19和44
第9步的乘数:25和51
第10步的乘数:26和52
第11步的乘数:28和53
第12步的乘数:29和54